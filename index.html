<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Amplifier Setup Calculator</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      padding-top: 40px;
    }

    .container {
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #007bff;
    }

    .form-group label {
      font-weight: bold;
    }

    #results {
      margin-top: 20px;
    }

    #results h3 {
      color: #28a745;
    }

    #outputVerificationResult {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h1 class="text-center mb-4">Amplifier Setup Calculator</h1>

    <!-- Amplifier Selection -->
    <div class="form-group">
      <label for="ampType">Select Amplifier Type:</label>
      <select id="ampType" class="form-control" onchange="setPresetValues()">
        <option value="BLE100">BLE100</option>
        <option value="MB100">MB100</option>
        <option value="BTD100">BTD100</option>
      </select>
    </div>

    <!-- Required Input Tilt -->
    <div class="form-group">
      <label for="inputTilt">Input Tilt from 129Mhz to 999MHz(dB):</label>
      <input type="number" id="inputTilt" class="form-control" value="4" required>
    </div>

    <!-- Delta Selection -->
    <div class="form-group">
      <label for="deltaType">Select Delta Calculation:</label>
      <select id="deltaType" class="form-control">
        <option value="Ch15-158">Ch15 - Ch158</option>
        <option value="Ch15-110">Ch15 - Ch110</option>
        <option value="Ch15-135">Ch15 - Ch135</option>
      </select>
    </div>

<!-- Channel Input Levels -->
<div class="input-section mb-4">
    <h3>Input Channel Levels</h3>
    <div class="form-group">
      <label for="ch15">Channel 15:</label>
      <input type="number" id="ch15" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="ch30">Channel 30:</label> <!-- New input field for Ch30 -->
      <input type="number" id="ch30" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="ch68">Channel 68:</label> <!-- New input field for Ch68 -->
      <input type="number" id="ch68" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="ch110">Channel 110:</label>
      <input type="number" id="ch110" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="ch135">Channel 135:</label>
      <input type="number" id="ch135" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="ch158">Channel 158:</label>
      <input type="number" id="ch158" class="form-control" required>
    </div>
    <button class="btn btn-primary" onclick="calculateEQ()">Calculate EQ and Pad</button>
  </div>
  

    <!-- Result Section -->
    <div id="results" class="mt-4">
      <h3>Results</h3>
      <p id="eqValue"></p>
      <p id="padValue"></p>
      <p id="tiltWarning" class="text-danger"></p>
    </div>
  </div>

  <!-- Bootstrap JS and dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <!-- JavaScript Logic -->
  <script>
    function setPresetValues() {
      const ampType = document.getElementById("ampType").value;
      const inputTilt = document.getElementById("inputTilt");

      // Set default input tilt based on amplifier type
      if (ampType === "BLE100") {
        inputTilt.value = 4; // 4 dB tilt for BLE100
      } else if (ampType === "MB100" || ampType === "BTD100") {
        inputTilt.value = 0; // Flat input (0 dB tilt) for MB100 and BTD100
      }
    }

    function calculateEQ() {
  // Ensure input fields are filled
  const ampType = document.getElementById("ampType").value;
  const deltaType = document.getElementById("deltaType").value;
  const ch15 = parseFloat(document.getElementById("ch15").value);
  const ch30 = parseFloat(document.getElementById("ch30").value); // Get Ch30 value
  const ch68 = parseFloat(document.getElementById("ch68").value); // Get Ch68 value
  const ch110 = parseFloat(document.getElementById("ch110").value);
  const ch135 = parseFloat(document.getElementById("ch135").value);
  const ch158 = parseFloat(document.getElementById("ch158").value);
  const inputTilt = parseFloat(document.getElementById("inputTilt").value);
  const tiltWarning = document.getElementById("tiltWarning");

  // Validate required inputs
  if (isNaN(ch15) || isNaN(ch30) || isNaN(ch68) || isNaN(ch110) || isNaN(ch135) || isNaN(ch158) || isNaN(inputTilt)) {
    alert("Please fill in all required fields.");
    return;
  }

      // Step 1: Validate Input Tilt
      if ((ampType === "BLE100" && inputTilt !== 4) || ((ampType === "MB100" || ampType === "BTD100") && inputTilt !== 0)) {
    tiltWarning.textContent = "This is not an ideal tilt for input. Please check previous amplifier configurations.";
    tiltWarning.style.color = "red"; // Display the message in red
  } else {
    tiltWarning.textContent = ""; // Clear warning if tilt is
      }

      // Step 2: Calculate Delta based on selected delta type
      let delta;
      switch (deltaType) {
        case "Ch15-110":
          delta = ch15 - ch110;
          break;
        case "Ch15-135":
          delta = ch15 - ch135;
          break;
        case "Ch15-158":
        default:
          delta = ch15 - ch158;
          break;
      }

      // Adjust Delta for BLE100 amplifier type
      if (ampType === "BLE100") {
        delta += 4;
      }

      // Lookup tables for SFE and SCS values based on delta type
      let sfeOptions, scsOptions;

      if (deltaType === "Ch15-110") {
        sfeOptions = [
          { delta: 11.1, value: 22 }, { delta: 9.5, value: 20 },
          { delta: 9.0, value: 18 }, { delta: 7.8, value: 16 },
          { delta: 6.9, value: 14 }, { delta: 6.0, value: 12 },
          { delta: 4.9, value: 10 }, { delta: 4.1, value: 8 },
          { delta: 3.0, value: 6 }, { delta: 2.1, value: 4 },
          { delta: 1.1, value: 2 }, { delta: 0.0, value: 0 }
        ];
        scsOptions = [
          { delta: -0.3, value: 2 }, { delta: -1.9, value: 4 },
          { delta: -3.0, value: 6 }, { delta: -4.8, value: 8 },
          { delta: -6.1, value: 10 }, { delta: -7.0, value: 12 },
          { delta: -8.3, value: 14 }
        ];
      } else if (deltaType === "Ch15-135") {
        sfeOptions = [
          { delta: 13.3, value: 22 }, { delta: 11.8, value: 20 },
          { delta: 10.7, value: 18 }, { delta: 9.3, value: 16 },
          { delta: 8.2, value: 14 }, { delta: 7.2, value: 12 },
          { delta: 6.0, value: 10 }, { delta: 5.0, value: 8 },
          { delta: 3.7, value: 6 }, { delta: 2.8, value: 4 },
          { delta: 1.6, value: 2 }, { delta: 0.0, value: 0 }
        ];
        scsOptions = [
          { delta: -1.6, value: 2 }, { delta: -3.6, value: 4 },
          { delta: -5.3, value: 6 }, { delta: -7.6, value: 8 },
          { delta: -9.3, value: 10 }, { delta: -10.5, value: 12 },
          { delta: -12.2, value: 14 }
        ];
      } else { // Ch15-158
        sfeOptions = [
          { delta: 15.5, value: 22 }, { delta: 13.6, value: 20 },
          { delta: 12.5, value: 18 }, { delta: 10.8, value: 16 },
          { delta: 9.5, value: 14 }, { delta: 8.5, value: 12 },
          { delta: 7.2, value: 10 }, { delta: 6.1, value: 8 },
          { delta: 4.3, value: 6 }, { delta: 3.4, value: 4 },
          { delta: 2.0, value: 2 }, { delta: 0.0, value: 0 }
        ];
        scsOptions = [
          { delta: -1.4, value: 2 }, { delta: -3.2, value: 4 },
          { delta: -4.8, value: 6 }, { delta: -6.8, value: 8 },
          { delta: -8.1, value: 10 }, { delta: -9.0, value: 12 },
          { delta: -10.3, value: 14 }
        ];
      }

      let eqType, eqValue;

      // Step 3: Determine the closest EQ or CS based on Delta
      if (delta === 0) {
        eqType = "SFE";
        eqValue = 0; // SFE-100-00
      } else if (delta >= 2) {
        eqType = "SFE";
        eqValue = sfeOptions.reduce((prev, curr) => Math.abs(curr.delta - delta) < Math.abs(prev.delta - delta) ? curr : prev).value;
      } else {
        eqType = "SCS";
        eqValue = scsOptions.reduce((prev, curr) => Math.abs(curr.delta - delta) < Math.abs(prev.delta - delta) ? curr : prev).value;
      }

      // Lookup table for EQ/CS cut values at Channel 15
      const eqCutAtCh15Lookup = {
        "SFE-22": 16.1, "SFE-20": 14.2, "SFE-18": 13.0, "SFE-16": 11.2,
        "SFE-14": 10.0, "SFE-12": 9.0,  "SFE-10": 7.7,  "SFE-08": 6.6,
        "SFE-06": 4.8,  "SFE-04": 3.9,  "SFE-02": 2.5,  "SFE-00": 0.0,
        "SCS-2": 1.5,   "SCS-4": 1.5,   "SCS-6": 1.6,   "SCS-8": 2.1,
        "SCS-10": 2.2,  "SCS-12": 2.4,  "SCS-14": 2.7
      };

      // Step 4: Find the EQ/CS Cut at Channel 15
      let eqCutAtCh15 = eqCutAtCh15Lookup[`${eqType}-${eqValue}`] || 0;

      // Step 5: Determine the Recommended Input for the Selected Amplifier
      let recommendedInput = ampType === "BLE100" ? 9 : 8; // BLE100 requires 9 dBmV, MB100 and BTD100 require 8 dBmV

      // Step 6: Calculate the First Pad Value
      let padValue = ch15 - recommendedInput - eqCutAtCh15;
      if (padValue < 0) {
        padValue = 0; // Use 0 dB if the result is negative
      }

      // Step 7: Display Results
      document.getElementById("eqValue").textContent = `Recommended ${eqType} Value: ${eqType}-100-${eqValue}`;
      document.getElementById("padValue").textContent = `Recommended Pad Value: ${padValue} dB`;
    }
  </script>
</body>
</html>
